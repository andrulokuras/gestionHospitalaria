<!-- Parte de la estructura de esta vista, incluyendo la organización del expediente
     clínico en secciones, el uso de pestañas dinámicas, la renderización de tablas
     con información del paciente y la integración con datos enviados desde el 
     servidor, fue generada y asistida mediante ChatGPT (OpenAI, versión GPT-5.1).
     
     El código fue posteriormente revisado, adaptado y personalizado por el estudiante
     para ajustarse a los requerimientos del sistema de historial clínico y a la 
     visualización específica de tratamientos, hospitalizaciones y citas del paciente. -->
{% extends "base.html" %}
{% block title %}Expediente: {{ data.paciente.nombre_completo }}{% endblock %}

{% block content %}

<div class="card mb-4 border-primary">
    <div class="card-header bg-primary text-white">
        <h3 class="mb-0">{{ data.paciente.nombre_completo }}</h3>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3"><strong>ID Paciente:</strong> {{ data.paciente.id_paciente }}</div>
            <div class="col-md-3"><strong>Fecha Nac:</strong> {{ data.paciente.fecha_nacimiento }}</div>
            <div class="col-md-3"><strong>Seguro:</strong> {{ data.paciente.seguro_medico }}</div>
            <div class="col-md-3"><strong>Teléfono:</strong> {{ data.paciente.telefono }}</div>
        </div>
    </div>
</div>

<ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="tratamientos-tab" data-bs-toggle="tab" data-bs-target="#tratamientos" type="button">Tratamientos</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="hospital-tab" data-bs-toggle="tab" data-bs-target="#hospital" type="button">Hospitalizaciones</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="citas-tab" data-bs-toggle="tab" data-bs-target="#citas" type="button">Citas Agendadas</button>
  </li>
</ul>

<div class="tab-content p-4 border border-top-0 bg-white" id="myTabContent">
  
  <div class="tab-pane fade show active" id="tratamientos">
      {% if data.tratamientos %}
        <table class="table table-striped">
            <thead><tr><th>Fecha</th><th>Tipo</th><th>Estado</th><th>Área</th></tr></thead>
            <tbody>
                {% for t in data.tratamientos %}
                <tr>
                    <td>{{ t.fecha_inicio }}</td>
                    <td><span class="badge bg-info">{{ t.tipo }}</span></td>
                    <td>{{ t.estado_actual }}</td>
                    <td>{{ t.nombre_area }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
      {% else %}
        <p class="text-muted">Este paciente no tiene tratamientos registrados.</p>
      {% endif %}
  </div>

  <div class="tab-pane fade" id="hospital">
      {% if data.hospitalizaciones %}
        <table class="table table-striped">
            <thead><tr><th>Ingreso</th><th>Egreso</th><th>Motivo</th><th>Habitación</th></tr></thead>
            <tbody>
                {% for h in data.hospitalizaciones %}
                <tr>
                    <td>{{ h.fecha_ingreso }}</td>
                    <td>{{ h.fecha_egreso or 'En curso' }}</td>
                    <td>{{ h.motivo_ingreso }}</td>
                    <td><span class="badge bg-warning text-dark">{{ h.habitacion }}</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
      {% else %}
        <p class="text-muted">No hay registros de hospitalización.</p>
      {% endif %}
  </div>

  <div class="tab-pane fade" id="citas">
      {% if data.citas %}
        <table class="table table-striped">
            <thead><tr><th>Fecha/Hora</th><th>Médico</th><th>Motivo</th><th>Estado</th></tr></thead>
            <tbody>
                {% for c in data.citas %}
                <tr>
                    <td>{{ c.fecha_hora_inicio }}</td>
                    <td>Dr. {{ c.nombre_medico }} ({{ c.especialidad }})</td>
                    <td>{{ c.motivo_consulta }}</td>
                    <td>{{ c.estado }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
      {% else %}
        <p class="text-muted">No hay historial de citas.</p>
      {% endif %}
  </div>

</div>

<div class="mt-3">
    <a href="{{ url_for('lista_historial') }}" class="btn btn-secondary">Volver a la lista</a>
</div>

{% endblock %}
